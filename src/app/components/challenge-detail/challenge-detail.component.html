<div class="challenge-detail-container fade-in" *ngIf="challenge">
    <!-- Header Section -->
    <div class="challenge-header">
        <div class="header-content">
            <span class="status-badge" [ngClass]="challenge.status | lowercase">{{ challenge.status }}</span>
            <h1>{{ challenge.name }}</h1>
            <p class="description">{{ challenge.description }}</p>

            <div class="meta-grid">
                <div class="meta-item">
                    <i class="fas fa-bullseye"></i>
                    <span>Goal: {{ challenge.goal_amount | number }} words ({{ challenge.goal_type }})</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-calendar-alt"></i>
                    <span>{{ challenge.start_date | date }} - {{ challenge.end_date | date }}</span>
                </div>
                <div class="meta-item">
                    <i class="fas" [ngClass]="challenge.is_public ? 'fa-globe' : 'fa-lock'"></i>
                    <span>{{ challenge.is_public ? 'Public' : 'Private' }}</span>
                </div>
            </div>

            <!-- Invite Code (Only for Private or Creator) -->
            <div class="invite-section" *ngIf="!challenge.is_public || challenge.invite_code">
                <p>Invite Code: <span class="code">{{ challenge.invite_code }}</span></p>
                <button class="btn-icon" (click)="copyCode()" title="Copy Code">
                    <i class="fas fa-copy"></i>
                </button>
            </div>
        </div>

        <!-- User Progress Card -->
        <div class="user-progress-card">
            <h3>Your Progress</h3>
            <div class="progress-circle">
                <svg viewBox="0 0 36 36" class="circular-chart">
                    <path class="circle-bg"
                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                    <path class="circle"
                        [attr.stroke-dasharray]="getPercent(userProgress, challenge.goal_amount) + ', 100'"
                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                </svg>
                <div class="percentage">
                    {{ getPercent(userProgress, challenge.goal_amount) }}%
                </div>
            </div>
            <p class="progress-text">{{ userProgress | number }} / {{ challenge.goal_amount | number }} words</p>

            <!-- Log Words -->
            <div class="log-words-form" *ngIf="challenge.status === 'Ongoing'">
                <input type="number" [(ngModel)]="todayWords" placeholder="Add Today's Words" min="1">
                <button class="btn-primary" (click)="addProgress()" [disabled]="!todayWords || todayWords <= 0">
                    <i class="fas fa-plus"></i> Add
                </button>
            </div>
        </div>
    </div>

    <div class="dashboard-grid">
        <!-- Leaderboard -->
        <div class="section leaderboard">
            <h3><i class="fas fa-trophy"></i> Leaderboard</h3>
            <div class="leaderboard-list">
                <div class="participant-row" *ngFor="let p of participants; let i = index"
                    [class.current-user]="p.user_id == currentUserId">
                    <div class="rank">{{ i + 1 }}</div>
                    <div class="info">
                        <span class="name">{{ p.username }}</span>
                        <!-- <span class="joined-date">Joined {{ p.joined_at | date }}</span> -->
                    </div>
                    <div class="score">
                        {{ p.current_progress | number }} words
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Logs / History -->
        <div class="section history">
            <h3><i class="fas fa-history"></i> Your Daily Log</h3>
            <div class="log-list" *ngIf="userLogs && userLogs.length > 0; else noLogs">
                <div class="log-item" *ngFor="let log of userLogs">
                    <span class="date">{{ log.log_date | date:'mediumDate' }}</span>
                    <span class="count">+{{ log.word_count | number }} words</span>
                </div>
            </div>
            <ng-template #noLogs>
                <div class="empty-logs">No activity yet. Start writing!</div>
            </ng-template>
        </div>
    </div>

    <!-- Actions -->
    <div class="actions-footer">
        <a routerLink="/challenges" class="btn-secondary">Back to Challenges</a>
    </div>

</div>

<app-content-loader *ngIf="isLoading"></app-content-loader>